#!/bin/sh
#此工具用于生成带有参数解析的shell工具
#功能由生成的工具重写定义


#DEFINITION
FILENAME="shtools"
if [ ! -z $1 ];then
    FILENAME=$1
else
    FILENAME="shtools"
fi
VERSION=$(date +"%Y.%m.%d")

HEADER="\
#!/bin/bash\n\
#This ${FILENAME} auto generated by shtoolsgenerater.\n\
#Copyright by Lovelace.Lee.\n\
#Version ${VERSION}\n\n"

HELP_INFO="\
function print_help()\n\
{\n\
\techo \"\"\n\
\techo \"Usage: ${FILENAME} [-options]\"\n\
\techo \"\t(-help|--help):\t\tshow help information\"\n\
\techo \"\"\n\
}\n\n"

PARSE_ARGS="\
#parse ARGS\n\
#\$* all args list passed by user\n\
function parseARGS()\n\
{\n\
\tfor arg in \$*\n\
\tdo\n\
\t\t#two arg type -arg or arg=value\n\
\t\tlvalue=\`echo \$arg | sed 's/=.*//g'\`\n\
\t\trvalue=\`echo \$arg | sed 's/.*=//g'\`\n\
\t\tif [ -n \"\$arg\" ];then #arg exist\n\
\t\t\tcase \$lvalue in\n\
\t\t\t-help|--help|--h|--he|--hel-h|-he|-hel)\n\
\t\t\t\tprint_help\n\
\t\t\t\texit 0;;\n\

\t\t\t*) \n\
\t\t\t\techo \"Unknown option $lvalue\"\n\
\t\t\t\treturn 110\n\
\t\t\t\t;;\n\
\t\t\tesac\n\
\t\tfi\n\
\tdone\n\
}\n\n\
if [ \$# -lt 1 ];then\n\
\tprint_help\n\
\texit\n\
fi\n\
parseARGS \$*;\n\
if [ \$? == 110 ];then\n\
\t#need help\n\
\tprint_help\n\
\texit 1;\n\
fi\n\
"


#OUTPUT FILE

function output_file()
{
    echo -e $HEADER > $FILENAME
    echo -e $HELP_INFO >> $FILENAME
    echo -e $PARSE_ARGS >> $FILENAME
}


#MAIN

function main()
{
    output_file;
    if [ -e $FILENAME ];then
        chmod 777 $FILENAME;
    else
        echo "shtools generated failed."
        exit;
    fi
}


main;
