#!/bin/bash
#This tardir auto generated by shtoolsgenerater.
#Copyright by Lovelace.Lee.
#Version 2013.10.23

#Ñ¹ËõÎÄ¼þ
WORKDIR=$(pwd -P)
TARLIST=$(ls)
DATE=$(date +"%Y%m%d")

ARGS=""

function print_help()
{
    echo ""
    echo "Usage: tardir [-options]"
    echo "  (-help|--help):     show help information"
    echo "  (.):            current directory"
    echo "  (-l):           file directory list"
    echo "  (-e):           exclude file or directory(--exclude=FILE command of tar)"
    echo ""
}


#parse ARGS
#$* all args list passed by user
function parseARGS()
{
    for arg in $*
    do
        #two arg type -arg or arg=value
        lvalue=`echo $arg | sed 's/=.*//g'`
        rvalue=`echo $arg | sed 's/.*=//g'`
        if [ -n "$arg" ];then #arg exist
            case $lvalue in
            -help|--help|--h|--he|--hel-h|-he|-hel)
                print_help
                exit 0;;
            .)
                WORKDIR=$(pwd -P);;
            -l)
                TARLIST=${rvalue//,/ };;
            -e)
                ARGS=--exclude=$rvalue;;
            *) 
                echo "Unknown option "
                return 110
                ;;
            esac
        fi
    done
}

function tardir()
{
    parseARGS $*;
    TARFILE="${WORKDIR##*/}.$DATE.tar.bz2"
    echo "generate file name \"$TARFILE\""
    tar jcvf $TARFILE $TARLIST $ARGS
}


if [ $# -lt 1 ];then
    print_help
    exit
fi
parseARGS $*;
if [ $? == 110 ];then
    #need help
    print_help
    exit 1;
fi
tardir;
